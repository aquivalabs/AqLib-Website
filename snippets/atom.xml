<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://aquivalabs.github.io/AqLib-Website/snippets</id>
    <title>AqLib Blog</title>
    <updated>2024-10-01T15:43:11.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://aquivalabs.github.io/AqLib-Website/snippets"/>
    <subtitle>AqLib Blog</subtitle>
    <icon>https://aquivalabs.github.io/AqLib-Website/img/AquivaLabs_icon-150x150.png</icon>
    <entry>
        <title type="html"><![CDATA[Delete all debug logs]]></title>
        <id>https://aquivalabs.github.io/AqLib-Website/snippets/delete-all-debug-logs</id>
        <link href="https://aquivalabs.github.io/AqLib-Website/snippets/delete-all-debug-logs"/>
        <updated>2024-10-01T15:43:11.000Z</updated>
        <summary type="html"><![CDATA[Mac/Linux only. Sets a debug log for 12 hours for a specific user]]></summary>
        <content type="html"><![CDATA[<p>Mac/Linux only. Sets a debug log for 12 hours for a specific user</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation:<a href="https://aquivalabs.github.io/AqLib-Website/snippets/delete-all-debug-logs#installation" class="hash-link" aria-label="Direct link to Installation:" title="Direct link to Installation:">​</a></h2>
<ol>
<li>Add the <a href="https://aquivalabs.github.io/AqLib-Website/snippets/delete-all-debug-logs##Script">script</a> to .bash_profile</li>
<li>Reload your bash profile by running <code>source ~/.bash_profile</code></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage:<a href="https://aquivalabs.github.io/AqLib-Website/snippets/delete-all-debug-logs#usage" class="hash-link" aria-label="Direct link to Usage:" title="Direct link to Usage:">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  sf_del_logs qa_env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sf_del_logs uat_env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sf_del_logs prod_env</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="script">Script<a href="https://aquivalabs.github.io/AqLib-Website/snippets/delete-all-debug-logs#script" class="hash-link" aria-label="Direct link to Script" title="Direct link to Script">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sf_del_logs() { sf data query -o "$1" -q "SELECT Id FROM ApexLog" -r csv &gt; apexLogs.csv &amp;&amp; sf data delete bulk -o "$1" -s ApexLog -f apexLogs.csv -w 10 ; rm apexLogs.csv }</span><br></span></code></pre></div></div>]]></content>
        <author>
            <name>Evgenii Azimzhanov</name>
            <email>eazimzhanov@aquivalabs.com</email>
            <uri>https://aquivalabs.slack.com/team/U3Y5VKY68</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Set the Debug Logs for a user]]></title>
        <id>https://aquivalabs.github.io/AqLib-Website/snippets/set-debug-logs-for-user</id>
        <link href="https://aquivalabs.github.io/AqLib-Website/snippets/set-debug-logs-for-user"/>
        <updated>2024-08-12T18:03:15.000Z</updated>
        <summary type="html"><![CDATA[Sets a debug log for 12 hours for a specific user]]></summary>
        <content type="html"><![CDATA[<p>Sets a debug log for 12 hours for a specific user</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage:<a href="https://aquivalabs.github.io/AqLib-Website/snippets/set-debug-logs-for-user#usage" class="hash-link" aria-label="Direct link to Usage:" title="Direct link to Usage:">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  log_dev.sh [-o arg] [-u arg] -z -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -o  target org to set debug log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -u  Name of an entity to set debug log</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples:<a href="https://aquivalabs.github.io/AqLib-Website/snippets/set-debug-logs-for-user#examples" class="hash-link" aria-label="Direct link to Examples:" title="Direct link to Examples:">​</a></h2>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  sh log_dev.sh -o a_ea -u Azimzhanov -z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sh log_dev.sh -o a_ea -u Azimzhanov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sh log_dev.sh -o a_ea -u "Evgenii Azimzhanov"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sh log_dev.sh -o a_ea -u "Evgenii Azi"</span><br></span></code></pre></div></div>
<h1>Script</h1>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_debug() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [[ $DEBUG_MODE == true ]] &amp;&amp; { separator; echo "${@}"; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_simple() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo "${@}"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">separator() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo "-----------------------------------"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse_params() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while getopts 'u:o:hz' opt; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    case "$opt" in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      u) TRACING_ENTITY_NAME="$OPTARG" ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      o) IN_ORG_ALIAS="$OPTARG" ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z) DEBUG_MODE=true ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ?|h) show_usage; exit 1 ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    esac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  shift "$(($OPTIND -1))"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [[ $DEBUG_MODE == true ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_debug "Received Params: "</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo "TRACING_ENTITY_NAME: $TRACING_ENTITY_NAME"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo "IN_ORG_ALIAS: $IN_ORG_ALIAS"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo "DEBUG_MODE: $DEBUG_MODE"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show_usage() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cat &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sets a debug log for 12 hours</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USAGE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  $(basename $0) [-o arg] [-u arg] -z -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -o  target org to set debug log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -u  Name of an entity to set debug log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXAMPLES:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sh log_dev.sh -o a_ea -u Azimzhanov -z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_and_handle_debug_level() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local debug_level_query="SELECT Id FROM DebugLevel WHERE DeveloperName = '$DEBUG_LEVEL_NAME'"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local debug_level_result=$(sf data query -o "$IN_ORG_ALIAS" -q "$debug_level_query" -t --json)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DEBUG_LEVEL_ID=$(jq -r '.result.records[0].Id' &lt;&lt;&lt; "$debug_level_result")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  log_debug "Debug level Found $DEBUG_LEVEL_ID"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [[ -z $DEBUG_LEVEL_ID || $DEBUG_LEVEL_ID == "null" ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_simple "Debug Level doesn't exist"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG_LEVEL_ID=$(sf data record create -o "$IN_ORG_ALIAS" -s DebugLevel -t -v "ApexCode=FINEST ApexProfiling=INFO Callout=INFO Database=INFO System=INFO Validation=INFO Visualforce=INFO Workflow=INFO MasterLabel='$DEBUG_LEVEL_NAME' DeveloperName='$DEBUG_LEVEL_NAME'" | jq -r '.result.id')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_simple "Successfully created Debug Level with ID: $DEBUG_LEVEL_ID"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_simple "Debug Level exists"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sf data record update -o "$IN_ORG_ALIAS" -i "$DEBUG_LEVEL_ID" -s DebugLevel -t -v "ApexCode=FINEST ApexProfiling=INFO Callout=INFO Database=INFO System=INFO Validation=INFO Visualforce=INFO Workflow=INFO"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_simple "Successfully updated Debug Level record: $DEBUG_LEVEL_ID."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_and_handle_trace_flag() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local trace_flag_query="SELECT Id, DebugLevelId FROM TraceFlag WHERE TracedEntity.Name LIKE '%$TRACING_ENTITY_NAME%'"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local trace_flag_result=$(sf data query -o "$IN_ORG_ALIAS" -q "$trace_flag_query" -t -r json)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local traced_entity_ids=$(jq -r '.result.records[].Id' &lt;&lt;&lt; "$trace_flag_result")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local traced_entity_debug_level_id=$(jq -r '.result.records[0].DebugLevelId' &lt;&lt;&lt; "$trace_flag_result")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local start_date=$(date -u '+%Y-%m-%dT%H:%M:%S')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local expiration_date=$(date -u -v +12H '+%Y-%m-%dT%H:%M:%S')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for traced_entity_id in $traced_entity_ids</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if [[ -n $traced_entity_id &amp;&amp; $traced_entity_id != "null" ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sf data record delete -o "$IN_ORG_ALIAS" -t -s TraceFlag -i "$traced_entity_id"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      log_simple "Deleted existing TraceFlag record with ID: $traced_entity_id"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local user_query_result=$(sf data query -o "$IN_ORG_ALIAS" -t --json -q "SELECT Id, Name FROM User WHERE Name LIKE '%$TRACING_ENTITY_NAME%' LIMIT 1")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local user_to_trace_id=$(jq -r '.result.records[0].Id' &lt;&lt;&lt; "$user_query_result")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [[ -z $user_to_trace_id || $user_to_trace_id == "null" ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_simple "Error: User to trace not found."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  log_debug "Found User to Trace, Id: $user_to_trace_id"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local create_trace_flag_result=$(sf data record create -o "$IN_ORG_ALIAS" -t -s TraceFlag -v "TracedEntityId=$user_to_trace_id LogType=USER_DEBUG DebugLevelId=$DEBUG_LEVEL_ID StartDate=$start_date ExpirationDate=$expiration_date" --json)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local create_trace_flag_success=$(jq -r '.status' &lt;&lt;&lt; "$create_trace_flag_result")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [[ $create_trace_flag_success == "0" ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_simple "Creating record for TraceFlag... Success"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_simple "Creating record for TraceFlag... Error"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_simple "Error: $(jq -r '.message' &lt;&lt;&lt; "$create_trace_flag_result")"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exit 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">delete_excessive_logs() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local log_query="SELECT Id FROM ApexLog ORDER BY SystemModstamp DESC LIMIT 1000"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local log_result=$(sf data query -o "$IN_ORG_ALIAS" -q "$log_query" -t --json)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if [[ -z $log_result || $log_result == "null" ]]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log_simple "No logs found to delete."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local log_ids=$(jq -r '.result.records[].Id' &lt;&lt;&lt; "$log_result")</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Create a CSV file with the log IDs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo "Id" &gt; log_ids.csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for log_id in $log_ids</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo "$log_id" &gt;&gt; log_ids.csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Delete logs in bulk using the CSV file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sf data delete bulk -o "$IN_ORG_ALIAS" -s ApexLog -f log_ids.csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Remove the CSV file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rm log_ids.csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IN_ORG_ALIAS=""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TRACING_ENTITY_NAME=""</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBUG_MODE=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">START_DATE=$(date '+%Y-%m-%dT%H:%M:%S')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPIRATION_DATE=$(date -v +12H '+%Y-%m-%dT%H:%M:%S')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBUG_LEVEL_NAME="Debugger_Custom"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parse_params "$@"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_debug "Debug Mode is enabled"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log_debug "Input Parameters:" "\n" "Target org is: $IN_ORG_ALIAS" "\n" "Tracing Entity Name is: $TRACING_ENTITY_NAME"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_and_handle_debug_level</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_and_handle_trace_flag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># delete_excessive_logs</span><br></span></code></pre></div></div>]]></content>
        <author>
            <name>Evgenii Azimzhanov</name>
            <email>eazimzhanov@aquivalabs.com</email>
            <uri>https://aquivalabs.slack.com/team/U3Y5VKY68</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Reset User after sandbox refresh]]></title>
        <id>https://aquivalabs.github.io/AqLib-Website/snippets/reset-user-after-refresh</id>
        <link href="https://aquivalabs.github.io/AqLib-Website/snippets/reset-user-after-refresh"/>
        <updated>2024-06-29T16:23:41.000Z</updated>
        <summary type="html"><![CDATA[Usage examples]]></summary>
        <content type="html"><![CDATA[<p>Usage examples</p>
<div class="language-apex codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-apex codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// reset a user that contains name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">resetUserAfterRefreshByName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Evgenii Azimzhanov'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">resetUserAfterRefreshByName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Evgenii Azi'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">resetUserAfterRefreshByName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Azi'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// reset a user by id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">resetUserAfterRefreshById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'0054M000003QHQNQA4'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Script</p>
<div class="language-apex codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-apex codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ResetUserException</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Resets the user after a refresh by their name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param name The name of the user to reset.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @throws ResetUserException if the name is empty.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @throws ResetUserException if more than one user is found with the given name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @throws ResetUserException if user was not found</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">resetUserAfterRefreshByName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">String</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isBlank</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ResetUserException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Empty name'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name keyword" style="color:#00009f">List</span><span class="token class-name punctuation" style="color:#393A34">&lt;</span><span class="token class-name">User</span><span class="token class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">selectUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// validate that we found only single user by name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">User</span><span class="token plain"> foundUser</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">User</span><span class="token plain"> u </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> users</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">u</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">foundUser </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ResetUserException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Two users found'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                foundUser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> u</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">resetUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">foundUser</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Resets the user after a refresh by their Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @param userId The Id of the user to reset.</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @throws ResetUserException if user was not found</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">resetUserAfterRefreshById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Id</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">User</span><span class="token plain"> foundUser </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">selectUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">resetUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">foundUser</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">resetUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">User</span><span class="token plain"> userToReset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userToReset </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ResetUserException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Cannot find the user'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// resetting user after refresh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userToReset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">isActive </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userToReset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Email</span><span class="token operator" style="color:#393A34">?.</span><span class="token function" style="color:#d73a49">endsWith</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'.invalid'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        userToReset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Email </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> userToReset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Email</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'.invalid'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userToReset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ProfileId </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sql language-sql punctuation" style="color:#393A34">[</span><span class="token sql language-sql keyword" style="color:#00009f">SELECT</span><span class="token sql language-sql"> Id </span><span class="token sql language-sql keyword" style="color:#00009f">FROM</span><span class="token sql language-sql"> Profile </span><span class="token sql language-sql keyword" style="color:#00009f">WHERE</span><span class="token sql language-sql"> Name </span><span class="token sql language-sql operator" style="color:#393A34">=</span><span class="token sql language-sql"> </span><span class="token sql language-sql string" style="color:#e3116c">'System Administrator'</span><span class="token sql language-sql"> </span><span class="token sql language-sql keyword" style="color:#00009f">LIMIT</span><span class="token sql language-sql"> </span><span class="token sql language-sql number" style="color:#36acaa">1</span><span class="token sql language-sql punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Id</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">update</span><span class="token plain"> userToReset</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'___________________Success___________________'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name keyword" style="color:#00009f">List</span><span class="token class-name punctuation" style="color:#393A34">&lt;</span><span class="token class-name">User</span><span class="token class-name punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">selectUsers</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Id</span><span class="token plain"> userId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">String</span><span class="token plain"> query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'SELECT Id, Name, Email, Profile.Name, Profile.UserLicenseId, CompanyName, IsActive FROM User '</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token keyword" style="color:#00009f">String</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isBlank</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        query </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'WHERE Name LIKE \'%'</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'%\''</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">userId </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        query </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'WHERE Id = :userId'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ResetUserException</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Either name or userId must be provided'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">' ORDER BY CompanyName NULLS LAST'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> Database</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>]]></content>
        <author>
            <name>Evgenii Azimzhanov</name>
            <email>eazimzhanov@aquivalabs.com</email>
            <uri>https://aquivalabs.slack.com/team/U3Y5VKY68</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Last Viewed Records]]></title>
        <id>https://aquivalabs.github.io/AqLib-Website/snippets/last-viewed-records</id>
        <link href="https://aquivalabs.github.io/AqLib-Website/snippets/last-viewed-records"/>
        <updated>2024-06-28T15:29:28.000Z</updated>
        <summary type="html"><![CDATA[And you can as well mark record (trigger LastViewedDate to be updated) with FOR VIEW operator]]></summary>
        <content type="html"><![CDATA[<div class="language-apex codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-apex codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> Id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> Whatever__c ORDER </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> LastViewedDate </span><span class="token keyword" style="color:#00009f">DESC</span><br></span></code></pre></div></div>
<p>And you can as well mark record (trigger LastViewedDate to be updated) with <code>FOR VIEW</code> operator</p>
<div class="language-apex codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-apex codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> Id </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> Whatever__c </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FOR</span><span class="token plain"> VIEW</span><br></span></code></pre></div></div>]]></content>
        <author>
            <name>Artem Kniazev</name>
            <uri>https://aquivalabs.slack.com/team/U1JCA0TJ7</uri>
        </author>
    </entry>
    <entry>
        <title type="html"><![CDATA[Single Currency Formatting]]></title>
        <id>https://aquivalabs.github.io/AqLib-Website/snippets/single-currency-formatting</id>
        <link href="https://aquivalabs.github.io/AqLib-Website/snippets/single-currency-formatting"/>
        <updated>2024-06-28T15:29:28.000Z</updated>
        <summary type="html"><![CDATA[How to format currency strings on orgs where multi-currency is not enabled]]></summary>
        <content type="html"><![CDATA[<p>How to format currency strings on orgs where multi-currency is not enabled
No multi-currency means that there is no CurrencyIsoCode field available<br>
<!-- -->You still can do currency formatting right in the SOQL</p>
<div class="language-apex codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-apex codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">Opportunity</span><span class="token plain"> o </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token sql language-sql punctuation" style="color:#393A34">[</span><span class="token sql language-sql keyword" style="color:#00009f">SELECT</span><span class="token sql language-sql"> </span><span class="token sql language-sql function" style="color:#d73a49">FORMAT</span><span class="token sql language-sql punctuation" style="color:#393A34">(</span><span class="token sql language-sql">Amount</span><span class="token sql language-sql punctuation" style="color:#393A34">)</span><span class="token sql language-sql"> AmountFormatted</span><span class="token sql language-sql punctuation" style="color:#393A34">,</span><span class="token sql language-sql"> Amount </span><span class="token sql language-sql keyword" style="color:#00009f">FROM</span><span class="token sql language-sql"> Opportunity </span><span class="token sql language-sql keyword" style="color:#00009f">LIMIT</span><span class="token sql language-sql"> </span><span class="token sql language-sql number" style="color:#36acaa">1</span><span class="token sql language-sql punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'AmountFormatted'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 1 200,00$</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">debug</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">o</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 1200.00</span><br></span></code></pre></div></div>
<blockquote>
<p>Use FORMAT with the SELECT clause to apply localized formatting to standard and custom number, date, time, and currency fields.
<a href="https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/sforce_api_calls_soql_select_format.htm" target="_blank" rel="noopener noreferrer">https://developer.salesforce.com/docs/atlas.en-us.soql_sosl.meta/soql_sosl/sforce_api_calls_soql_select_format.htm</a></p>
</blockquote>]]></content>
        <author>
            <name>Artem Kniazev</name>
            <uri>https://aquivalabs.slack.com/team/U1JCA0TJ7</uri>
        </author>
    </entry>
</feed>